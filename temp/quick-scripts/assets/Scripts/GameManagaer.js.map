{"version":3,"sources":["GameManagaer.js"],"names":["ROWS","cc","Class","extends","Component","properties","scoreLabel","Label","bestScoreLabel","blockPrefab","Prefab","bgBox","Node","cellPrefab","loseLayOut","winLayOut","_gap","default","serializable","_blockSize","_data","_arrBlock","_posisions","_score","_canMove","onLoad","active","start","width","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","getScoreStorge","blockInit","init","arrInit","x","y","blockArr","Array","i","j","updateScore","row","col","getComponent","setNumber","addBlock","push","height","block","instantiate","parent","setPosition","v2","getEmptyLocations","locations","length","location","Math","floor","random","position","number","num","string","event","keyCode","macro","KEY","right","blockMoveRight","left","blockMoveLeft","up","blockMoveUp","down","blockMoveDown","afterMove","hasMoved","checkScore","checkGameOver","gameOver","moveBlock","callback","action","moveTo","finish","callFunc","runAction","sequence","combineBlock","b1","b2","destroy","scale1","scaleTo","scale2","mid","n","move","toMove","count","tween","node","to","opacity","gameWin","onRestartClick","onContinueClick","log","scoreStorge","sys","localStorage","getItem","JSON","parse","newScore","parseInt","setItem","stringify"],"mappings":"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","file":"GameManagaer.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["const ROWS = 4;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        scoreLabel : cc.Label,\n        bestScoreLabel : cc.Label,\n        blockPrefab : cc.Prefab,\n        bgBox : cc.Node,\n        cellPrefab : cc.Prefab,\n        loseLayOut: cc.Node,\n        winLayOut: cc.Node,\n        _gap :{\n            default : 10,\n            serializable : false,\n        },\n        _blockSize : null,\n        _data: [],\n        _arrBlock : [],\n        _posisions : [],\n        _score : null,\n        _canMove : true,\n    },\n\n    onLoad(){\n        this._canMove = true;\n        this.loseLayOut.active = false;\n    },\n    \n    start () {\n        this._blockSize = (this.bgBox.width - this._gap * 5) / 4;\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        \n        this.getScoreStorge();\n        this.blockInit();\n        this.init();\n    },\n\n    arrInit(x, y){\n        let blockArr = new Array();\n        for (let i = 0; i < x; i++) {\n            blockArr[i] = new Array();\n            for (let j = 0; j < y; j++) {\n                blockArr[i][j] = 0;\n            }\n        }\n        return blockArr;\n    },\n\n    init(){\n        this.updateScore(0);\n        this._data = this. arrInit(ROWS, ROWS);\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                this._arrBlock[row][col].getComponent(\"BlockController\").setNumber(0);    \n                this._data[row][col] = 0;            \n            }\n        };   \n        this.addBlock();\n        this.addBlock();\n    },\n\n    blockInit(){\n        this._arrBlock = this.arrInit(ROWS, ROWS);\n\n        for(let i = 0; i < ROWS; i++){\n            this._posisions.push([0,0,0,0]);\n            for(let j = 0; j < ROWS; j++){\n                let x = -(this.bgBox.width / 2) + (this._gap * (j + 1) + this._blockSize / 2 * (2 * j + 1));\n                let y = (this.bgBox.height / 2) - (this._gap * (i + 1) + this._blockSize / 2 * (2 * i + 1));\n                let block = cc.instantiate(this.blockPrefab);\n                block.parent = this.bgBox;\n                block.width = this._blockSize;\n                block.height = this._blockSize;\n                block.setPosition(cc.v2(x, y));\n                this._posisions[i][j] = (cc.v2(x, y));\n                block.getComponent(\"BlockController\").setNumber(0);\n                this._arrBlock[i][j] = (block);\n            }\n        }\n       \n    },\n\n    getEmptyLocations(){\n        let locations = [];\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                if(this._data[row][col] === 0){\n                    locations.push({\n                        x : row,\n                        y : col,\n                    })\n                }                \n            }\n        }\n        return locations;\n    },\n\n    addBlock(){\n        let locations = this.getEmptyLocations();\n        if(locations.length === 0) return false;\n\n        let location = locations[Math.floor(Math.random() * locations.length)];\n        let x = location.x;\n        let y = location.y;\n        let position = this._posisions[x][y];\n        let block = cc.instantiate(this.blockPrefab);\n        block.width = this._blockSize;\n        block.height = this._blockSize;\n        block.parent = this.bgBox;\n        block.setPosition(position);\n        \n        let number = Math.random() <= 0.95 ? 2 : 4;\n        block.getComponent(\"BlockController\").setNumber(number);\n        this._arrBlock[x][y] = block;\n        this._data[x][y] = number;\n\n        return true;\n    },\n\n    updateScore(num){\n        this._score = num;\n        this.scoreLabel.string = num;\n    },\n\n    onKeyDown(event){\n        switch (event.keyCode) {\n            case cc.macro.KEY.right:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveRight();\n                    \n                }\n                break;\n            case cc.macro.KEY.left:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveLeft();\n                    \n                }\n                \n                break;\n            case cc.macro.KEY.up:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveUp();\n                }\n                break;\n            case cc.macro.KEY.down:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveDown();\n                    \n                }\n                break;\n        }\n    },\n\n    afterMove(hasMoved){\n        this._canMove = true\n        if(hasMoved){\n            this.updateScore(this._score + 1);\n            this.addBlock();\n            this.checkScore();\n        }\n        else if(this.checkGameOver()){\n            this.gameOver()\n        }\n    },\n\n    moveBlock(block, position, callback){\n        let action = cc.moveTo(.05, position);\n        let finish = cc.callFunc(()=>{\n            callback && callback();\n        })\n        block.runAction(cc.sequence(action, finish,));\n    },\n\n    combineBlock(b1, b2, num, callback){\n        b1.destroy();\n        let scale1 = cc.scaleTo(0.1, 1.1);\n        let scale2 = cc.scaleTo(0.1, 1);\n        let mid = cc.callFunc(()=>{\n            b2.getComponent(\"BlockController\").setNumber(num);\n        });\n        let finish = cc.callFunc(()=>{\n            callback && callback();\n        })\n        b2.runAction(cc.sequence(scale1, mid, scale2, finish));\n    },\n\n    checkGameOver(){  \n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++) {\n                let n = this._data[i][j];\n                if(n === 0) return false;\n                if(j > 0 && this._data[i][j - 1] == n) return false;\n                if(j < ROWS - 1 && this._data[i][j + 1] == n) return false;\n                if(i > 0 && this._data[i - 1][j] == n) return false;\n                if(i < ROWS - 1 && this._data[i + 1][j] == n) return false; \n                \n            }       \n        }\n        return true;\n    },\n\n    blockMoveRight(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(y == ROWS + 1 || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x][y + 1] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y + 1];\n                this._arrBlock[x][y + 1] = block;\n                this._data[x][y + 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, ()=>{\n                    move(x, y + 1, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x][y + 1] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y + 1];\n               \n                this._data[x][y + 1] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, ()=>{\n                    this.combineBlock(block, this._arrBlock[x][y + 1], this._data[x][y + 1],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        \n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = ROWS - 1; j >= 0; j--){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveLeft(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(y == 0 || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x][y - 1] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y - 1];\n                this._arrBlock[x][y - 1] = block;\n                this._data[x][y - 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, ()=>{\n                    move(x, y - 1, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x][y - 1] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y - 1];\n               \n                this._data[x][y - 1] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, ()=>{\n                    this.combineBlock(block, this._arrBlock[x][y - 1], this._data[x][y - 1],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveDown(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(x == ROWS - 1  || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x + 1][y] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x + 1][y];\n                this._arrBlock[x + 1][y] = block;\n                this._data[x + 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, ()=>{\n                    move(x + 1, y, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x + 1][y] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x + 1][y];\n               \n                this._data[x + 1][y] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, ()=>{\n                    this.combineBlock(block, this._arrBlock[x + 1][y], this._data[x + 1][y],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = ROWS - 1; i >= 0; i--) {\n            for (let j = 0; j < ROWS; j++){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveUp(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(x == 0  || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x - 1][y] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x - 1][y];\n                this._arrBlock[x - 1][y] = block;\n                this._data[x - 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, ()=>{\n                    move(x - 1, y, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x - 1][y] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x - 1][y];\n               \n                this._data[x - 1][y] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, ()=>{\n                    this.combineBlock(block, this._arrBlock[x - 1][y], this._data[x - 1][y],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    gameOver(){\n        cc.tween(this.node)\n            .to(.5,{opacity:150})\n            .start()\n        this.loseLayOut.active = true;\n    },\n\n    gameWin(){\n        this._canMove = false;\n        cc.tween(this.node)\n            .to(.5,{opacity:150})\n            .start()\n        this.winLayOut.active = true;\n    },\n\n    onRestartClick(){\n        this._canMove = true;\n        this.blockInit();\n        this.init();\n        this.node.opacity = 255;\n        this.loseLayOut.active = false\n        this.winLayOut.active = false\n    },\n\n    onContinueClick(){\n        this._canMove = true;\n        this.node.opacity = 255;\n        this.winLayOut.active = false\n    },\n\n    getScoreStorge(){\n        cc.log(this.bestScoreLabel.string)\n        let scoreStorge = cc.sys.localStorage.getItem('bestScore');\n        if(scoreStorge !== null){\n            this.bestScoreLabel.string = JSON.parse(scoreStorge);\n        }else{\n            this.bestScoreLabel.string = 0;\n        }\n    },\n\n    checkScore(){\n        cc.log(\"score \" + this.scoreLabel.string);\n        cc.log(\"best score \" +this.bestScoreLabel.string);\n        let newScore = parseInt(this.scoreLabel.string);\n        if(newScore > this.bestScoreLabel.string){\n            cc.sys.localStorage.setItem('bestScore', JSON.stringify(newScore));\n            this.bestScoreLabel.string = newScore;\n        }\n    },\n\n});\n"]}