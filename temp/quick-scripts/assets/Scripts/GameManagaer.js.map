{"version":3,"sources":["GameManagaer.js"],"names":["ROWS","cc","Class","extends","Component","properties","scoreLabel","Label","bestScoreLabel","blockPrefab","Prefab","bgBox","Node","cellPrefab","loseLayOut","winLayOut","_gap","default","serializable","_blockSize","_data","_arrBlock","_posisions","_score","_canMove","onLoad","active","start","width","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","blockInit","init","arrInit","x","y","blockArr","Array","i","j","updateScore","row","col","getComponent","setNumber","addBlock","push","height","block","instantiate","parent","setPosition","v2","getEmptyLocations","locations","length","location","Math","floor","random","position","number","num","string","event","keyCode","macro","KEY","right","blockMoveRight","left","blockMoveLeft","up","blockMoveUp","down","blockMoveDown","updateBlockNum","afterMove","hasMoved","checkGameOver","gameOver","moveBlock","callback","action","moveTo","finish","callFunc","runAction","sequence","combineBlock","b1","b2","destroy","scale1","scaleTo","scale2","mid","n","move","toMove","count","tween","node","to","opacity","gameWin","onRestartClick","onContinueClick"],"mappings":"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","file":"GameManagaer.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["const ROWS = 4;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        scoreLabel : cc.Label,\n        bestScoreLabel : cc.Label,\n        blockPrefab : cc.Prefab,\n        bgBox : cc.Node,\n        cellPrefab : cc.Prefab,\n        loseLayOut: cc.Node,\n        winLayOut: cc.Node,\n        _gap :{\n            default : 10,\n            serializable : false,\n        },\n        _blockSize : null,\n        _data: [],\n        _arrBlock : [],\n        _posisions : [],\n        _score : null,\n        _canMove : true,\n    },\n\n    onLoad(){\n        this._canMove = true;\n        this.loseLayOut.active = false;\n    },\n    \n    start () {\n        this._blockSize = (this.bgBox.width - this._gap * 5) / 4;\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        \n        this.blockInit();\n        this.init();\n    },\n\n    arrInit(x, y){\n        let blockArr = new Array();\n        for (let i = 0; i < x; i++) {\n            blockArr[i] = new Array();\n            for (let j = 0; j < y; j++) {\n                blockArr[i][j] = 0;\n            }\n        }\n        return blockArr;\n    },\n\n    init(){\n        this.updateScore(0);\n        this._data = this. arrInit(ROWS, ROWS);\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                this._arrBlock[row][col].getComponent(\"BlockController\").setNumber(0);    \n                this._data[row][col] = 0;            \n            }\n        };   \n        this.addBlock();\n        this.addBlock();\n    },\n\n    blockInit(){\n        this._arrBlock = this.arrInit(ROWS, ROWS);\n\n        for(let i = 0; i < ROWS; i++){\n            this._posisions.push([0,0,0,0]);\n            for(let j = 0; j < ROWS; j++){\n                let x = -(this.bgBox.width / 2) + (this._gap * (j + 1) + this._blockSize / 2 * (2 * j + 1));\n                let y = (this.bgBox.height / 2) - (this._gap * (i + 1) + this._blockSize / 2 * (2 * i + 1));\n                let block = cc.instantiate(this.blockPrefab);\n                block.parent = this.bgBox;\n                block.width = this._blockSize;\n                block.height = this._blockSize;\n                block.setPosition(cc.v2(x, y));\n                this._posisions[i][j] = (cc.v2(x, y));\n                block.getComponent(\"BlockController\").setNumber(0);\n                this._arrBlock[i][j] = (block);\n            }\n        }\n       \n    },\n\n    getEmptyLocations(){\n        let locations = [];\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                if(this._data[row][col] === 0){\n                    locations.push({\n                        x : row,\n                        y : col,\n                    })\n                }                \n            }\n        }\n        return locations;\n    },\n\n    addBlock(){\n        let locations = this.getEmptyLocations();\n        if(locations.length === 0) return false;\n\n        let location = locations[Math.floor(Math.random() * locations.length)];\n        let x = location.x;\n        let y = location.y;\n        let position = this._posisions[x][y];\n        let block = cc.instantiate(this.blockPrefab);\n        block.width = this._blockSize;\n        block.height = this._blockSize;\n        block.parent = this.bgBox;\n        block.setPosition(position);\n        \n        let number = Math.random() <= 0.9 ? 2 : 4;\n        block.getComponent(\"BlockController\").setNumber(number);\n        this._arrBlock[x][y] = block;\n        this._data[x][y] = number;\n\n        return true;\n    },\n\n    updateScore(num){\n        this._score = num;\n        this.scoreLabel.string = num;\n    },\n\n    onKeyDown(event){\n        switch (event.keyCode) {\n            case cc.macro.KEY.right:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveRight();\n                    \n                }\n                break;\n            case cc.macro.KEY.left:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveLeft();\n                    \n                }\n                \n                break;\n            case cc.macro.KEY.up:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveUp();\n                }\n                break;\n            case cc.macro.KEY.down:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveDown();\n                    \n                }\n                break;\n        }\n    },\n\n    updateBlockNum: function () {\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                this._arrBlock[row][col].getComponent(\"BlockController\").setNumber(this._data[row][col]);\n            }\n        }\n    },\n\n    afterMove(hasMoved){\n        this._canMove = true\n        if(hasMoved){\n            this.updateScore(this._score + 1);\n            this.addBlock();\n        }\n        else if(this.checkGameOver()){\n            this.gameOver()\n        }\n    },\n\n    moveBlock(block, position, callback){\n        let action = cc.moveTo(.05, position);\n        let finish = cc.callFunc(()=>{\n            callback && callback();\n        })\n        block.runAction(cc.sequence(action, finish,));\n    },\n\n    combineBlock(b1, b2, num, callback){\n        b1.destroy();\n        let scale1 = cc.scaleTo(0.1, 1.1);\n        let scale2 = cc.scaleTo(0.1, 1);\n        let mid = cc.callFunc(()=>{\n            b2.getComponent(\"BlockController\").setNumber(num);\n        });\n        let finish = cc.callFunc(()=>{\n            callback && callback();\n        })\n        b2.runAction(cc.sequence(scale1, mid, scale2, finish));\n    },\n\n    checkGameOver(){  \n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++) {\n                let n = this._data[i][j];\n                if(n === 0) return false;\n                if(j > 0 && this._data[i][j - 1] == n) return false;\n                if(j < ROWS - 1 && this._data[i][j + 1] == n) return false;\n                if(i > 0 && this._data[i - 1][j] == n) return false;\n                if(i < ROWS - 1 && this._data[i + 1][j] == n) return false; \n                \n            }       \n        }\n        return true;\n    },\n\n    blockMoveRight(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(y == ROWS + 1 || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x][y + 1] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y + 1];\n                this._arrBlock[x][y + 1] = block;\n                this._data[x][y + 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, ()=>{\n                    move(x, y + 1, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x][y + 1] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y + 1];\n               \n                this._data[x][y + 1] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, ()=>{\n                    this.combineBlock(block, this._arrBlock[x][y + 1], this._data[x][y + 1],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        \n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = ROWS - 1; j >= 0; j--){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveLeft(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(y == 0 || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x][y - 1] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y - 1];\n                this._arrBlock[x][y - 1] = block;\n                this._data[x][y - 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, ()=>{\n                    move(x, y - 1, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x][y - 1] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y - 1];\n               \n                this._data[x][y - 1] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, ()=>{\n                    this.combineBlock(block, this._arrBlock[x][y - 1], this._data[x][y - 1],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveDown(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(x == ROWS - 1  || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x + 1][y] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x + 1][y];\n                this._arrBlock[x + 1][y] = block;\n                this._data[x + 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, ()=>{\n                    move(x + 1, y, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x + 1][y] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x + 1][y];\n               \n                this._data[x + 1][y] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, ()=>{\n                    this.combineBlock(block, this._arrBlock[x + 1][y], this._data[x + 1][y],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = ROWS - 1; i >= 0; i--) {\n            for (let j = 0; j < ROWS; j++){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveUp(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(x == 0  || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x - 1][y] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x - 1][y];\n                this._arrBlock[x - 1][y] = block;\n                this._data[x - 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, ()=>{\n                    move(x - 1, y, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x - 1][y] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x - 1][y];\n               \n                this._data[x - 1][y] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, ()=>{\n                    this.combineBlock(block, this._arrBlock[x - 1][y], this._data[x - 1][y],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    gameOver(){\n        cc.tween(this.node)\n            .to(.5,{opacity:150})\n            .start()\n        this.loseLayOut.active = true;\n    },\n\n    gameWin(){\n        this._canMove = false;\n        cc.tween(this.node)\n            .to(.5,{opacity:150})\n            .start()\n        this.winLayOut.active = true;\n    },\n\n    onRestartClick(){\n        this._canMove = true;\n        this.blockInit();\n        this.init();\n        this.node.opacity = 255;\n        this.loseLayOut.active = false\n        this.winLayOut.active = false\n    },\n\n    onContinueClick(){\n        this._canMove = true;\n        this.node.opacity = 255;\n        this.winLayOut.active = false\n    }\n\n});\n"]}